<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/assets/main.bundle.css"/>
    <script src="/assets/main.bundle.js" defer></script>
    <title>{{ title }} | TEA Stack</title>
    {% block head %}{% endblock %}
  </head>
  <body class="text-white bg-mydark-500 {{ 'debug-screens' if env.devMode }}">
    {% include 'header.njk' %}
    {% if banner %}
      {% include "banner.njk" %}
    {% endif %}
    {% block body %}
      <div
      class="py-8 m-0 bg-mydark-300"
    >
        {% if page.url == '/pages/about/' %}
          <div class=" markdown container max-w-6xl">
            {{ content | safe }}
          </div>
        {% endif %}
        {% if page.url != '/pages/about/' %}
          {{ content | safe }}
        {% endif %}
      </div>
    {% endblock %}
    {% include "footer.njk" %}
    <script defer>
      if (window.ResizeObserver && document.getElementById('reading-progress')) {
        const progress = document.getElementById('reading-progress');

        let timeOfLastScroll = 0;
        let requestedAniFrame = false;
        function scroll() {
          if (!requestedAniFrame) {
            requestAnimationFrame(updateProgress);
            requestedAniFrame = true;
          }
          timeOfLastScroll = Date.now();
        }
        addEventListener('scroll', scroll);

        let winHeight = 1000;
        let bottom = 10000;
        function updateProgress() {
          requestedAniFrame = false;
          const percent = Math.min((document.scrollingElement.scrollTop / (bottom - winHeight)) * 100, 100);
          progress.style.transform = `translate(-${ 100 - percent}vw, 0)`;
          if (Date.now() - timeOfLastScroll < 3000) {
            requestAnimationFrame(updateProgress);
            requestedAniFrame = true;
          }
        }

        new ResizeObserver(() => {
          bottom = document.scrollingElement.scrollTop + document
            .querySelector('footer')
            .getBoundingClientRect()
            .bottom;
          winHeight = window.innerHeight;
          scroll();
        }).observe(document.body);
      }
    </script>
  </body>
</html>